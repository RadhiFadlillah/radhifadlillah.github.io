<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/themes/geos2/res/apple-touch-icon-144x144.png><link rel=apple-touch-icon-precomposed sizes=152x152 href=/themes/geos2/res/apple-touch-icon-152x152.png><link rel=icon type=image/png href=/themes/geos2/res/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/themes/geos2/res/favicon-16x16.png sizes=16x16><script data-goatcounter=https://radhifadlillah.goatcounter.com/count async src=//gc.zgo.at/count.js></script><link href=/themes/geos2/css/fonts.css rel=stylesheet><link href=/themes/geos2/css/index.css rel=stylesheet><title>Build Caddy from Source in 2019 - Radhi Fadlillah</title><div class=file-page><div class="window reader"><div class=window__header><p class=window__header__title>Build Caddy from Source in 2019 (23/6/19)</div><div class="window__status-bar url-trail file-page__url-trail"><a href=/ class=url-trail__item>&lt;root></a>
<a href=/blog class=url-trail__item>blog</a>
<a href=/blog/2019-06-23-build-caddy-from-source-2019 class=url-trail__item>&lt;current-file></a></div><div class="window__content reader__content"><p>Since my <a href=/post/2018-08-19-build-caddy-from-source>previous</a> tutorial in 2018, there are many changes and improvement in Caddy Server. One of the improvement is the building process now far easier than before.<p>In the past, to build Caddy with several plugins installed, we need to modify Caddy's source code. This is not exactly easy, especially for beginner. Today, thanks to Go module, we can easily do it without modifying the source code.<p>For example, here we will build Caddy with <a href=https://github.com/caddyserver/dnsproviders/tree/master/cloudflare>dns.cloudflare</a> plugin which allows you to obtain certificates using DNS records for domains managed with Cloudflare. Before you start, make sure Go 1.12 or newer already installed on your system.<h3 id=building-caddy-and-its-plugins>Building Caddy and Its Plugins</h3><p>First, create a new folder anywhere and create a Go file with following content:<pre class=chroma><span class=kn>package</span> <span class=nx>main</span>

<span class=kn>import</span> <span class=p>(</span>
    <span class=c1>// The main Caddy server
</span><span class=c1></span>	<span class=s>&#34;github.com/caddyserver/caddy/caddy/caddymain&#34;</span>
	
	<span class=c1>// Caddy plugins, use underscore as import name
</span><span class=c1></span>	<span class=nx>_</span> <span class=s>&#34;github.com/caddyserver/dnsproviders/cloudflare&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
	<span class=nx>caddymain</span><span class=p>.</span><span class=nf>Run</span><span class=p>()</span>
<span class=p>}</span>
</pre><p>Next, initiate the folder as Go module named <code>caddy</code>:<pre><code>go mod init caddy
</code></pre><p>After that, add and update Caddy as module dependency:<pre><code>go get -u github.com/caddyserver/caddy
</code></pre><p>Now we just need to install it by running <code>go install</code> which will put <code>caddy</code> in <code>$GOPATH/bin</code>.<h3 id=run-caddy>Run Caddy</h3><p>As web server, Caddy will need the access to port 80 (HTTP) and 443 (HTTPs). To do so, we need to let Caddy to listen to port &lt; 1024 by running :<pre class=chroma>sudo setcap <span class=nv>cap_net_bind_service</span><span class=o>=</span>+ep <span class=nv>$GOPATH</span>/bin/caddy
</pre><p>Next we need to increase the maximum number of open files in our server. To do this, we need to increase the limit of file descriptor by running :<pre class=chroma><span class=nb>ulimit</span> -n <span class=m>8192</span>
</pre><p>Now we could run Caddy in background as the web server. There are several ways to do this. We can use <code>nohup</code> and <code>cron</code> to run Caddy in background when the server start. To do this, first open the <code>cron</code> configuration file by running :<pre class=chroma>crontab -e
</pre><p>Next add these lines to the end of file :<pre class=chroma>@reboot . <span class=nv>$HOME</span>/.profile <span class=o>&amp;&amp;</span> nohup caddy -conf <span class=s2>&#34;/path/to/Caddyfile&#34;</span> &gt;&gt; ~/Caddy.log 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=p>&amp;</span>
</pre><p>We can also create Caddy as system <a href=/post/2018-09-28-create-a-service-systemd/>service</a> which might be more preferrable for most people.<div class=reader__tags><p>Tags:</p><a href=/blog/tag-caddy>#caddy</a>
<a href=/blog/tag-linux>#linux</a>
<a href=/blog/tag-sysadmin>#sysadmin</a>
<a href=/blog/tag-tutorial>#tutorial</a></div><div class=reader__sibling><a href=/blog/2019-05-13-fix-wifi-after-update-manjaro class=reader__sibling__prev>Fix WiFi Doesn't Work After Update in Manjaro</a>
<a href=/blog/2019-07-23-qamel-dev-news-july-2019 class=reader__sibling__next>Qamel Development News: July 2019</a></div></div><div class=window__footer></div></div></div>